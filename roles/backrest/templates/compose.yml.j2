services:
  backrest:
    image: garethgeorge/backrest:v1.10.1@sha256:1308397161321b3c5aeca8acc6bf26eccb990df385f2532d3ce0eaa8b483dedf
    container_name: "{{ services.backrest.container_name }}"
    restart: always
    networks:
      - caddy
    volumes:
      - "{{ backrest_data_dir }}/data:/data"
      - "{{ backrest_data_dir }}/config:/config"
      - "{{ backrest_data_dir }}/cache:/cache"
      - "{{ backrest_data_dir }}/tmp:/tmp"
      - "/root/.config/rclone:/root/.config/rclone"
      - "{{ backup_base_dir }}:{{ backup_base_dir }}:ro"
    environment:
      BACKREST_DATA: "/data"
      BACKREST_CONFIG: "/config/config.json"
      RESTIC_PASSWORD: "{{ restic_password }}"
      XDG_CACHE_HOME: "/cache"
      TMPDIR: "/tmp"
      TZ: "{{ timezone }}"

networks:
  caddy:
    external: true
