# external-file
# owner: goauthentik
# repo: authentik
# path: docker-compose.yml
# commit-hash: db213a89447a0e2be67eb7d58fdf7e6a5b6defae

services:
  postgresql:
    image: postgres:16-alpine@sha256:029660641a0cfc575b14f336ba448fb8a75fd595d42e1fa316b9fb4378742297
    container_name: "authentik-postgres"
    restart: always
    volumes:
      - "{{ authentik_data_dir }}/db:/var/lib/postgresql/data"
  redis:
    image: redis:alpine@sha256:28c9c4d7596949a24b183eaaab6455f8e5d55ecbf72d02ff5e2c17fe72671d31
    container_name: "authentik-redis"
    restart: always
    volumes:
      - "{{ authentik_data_dir }}/redis:/data"
  server:
    image: authentik/server:2025.10.0@sha256:a283f44eefd68bcfc25cdfbdc0372e6384b60468ca042278bde0a4bd8af4680f
    container_name: "{{ services.authentik.container_name }}"
    restart: always
    networks:
      - default
      - caddy
    ports: !reset []
    volumes:
      - "{{ authentik_data_dir }}/media:/media"
      - "{{ authentik_data_dir }}/templates:/templates"
  worker:
    image: authentik/server:2025.10.0@sha256:a283f44eefd68bcfc25cdfbdc0372e6384b60468ca042278bde0a4bd8af4680f
    container_name: "authentik-worker"
    restart: always
    volumes:
      - "{{ authentik_data_dir }}/media:/media"
      - "{{ authentik_data_dir }}/certs:/certs"
      - "{{ authentik_data_dir }}/templates:/templates"

networks:
  caddy:
    external: true
