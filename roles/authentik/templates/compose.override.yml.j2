services:
  postgresql:
    image: postgres:16-alpine
    container_name: "authentik-postgres"
    restart: always
    volumes:
      - "{{ authentik_data_dir }}/db:/var/lib/postgresql/data"
  redis:
    image: redis:alpine
    container_name: "authentik-redis"
    restart: always
    volumes:
      - "{{ authentik_data_dir }}/redis:/data"
  server:
    image: authentik/server:2025.8.4
    container_name: "{{ services.authentik.container_name }}"
    restart: always
    networks:
      - default
      - caddy
    ports: !reset null
    volumes:
      - "{{ authentik_data_dir }}/media:/media"
      - "{{ authentik_data_dir }}/templates:/templates"
  worker:
    image: authentik/server:2025.8.4
    container_name: "authentik-worker"
    restart: always
    volumes:
      - "{{ authentik_data_dir }}/media:/media"
      - "{{ authentik_data_dir }}/certs:/certs"
      - "{{ authentik_data_dir }}/templates:/templates"

networks:
  caddy:
    external: true
