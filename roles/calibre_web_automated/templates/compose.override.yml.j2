# external-file
# owner: crocodilestick
# repo: Calibre-Web-Automated
# path: docker-compose.yml
# commit-hash: ad7ed735d7092d267a2f0646a13bd07e37ec39d6

services:
  calibre-web-automated:
    image: crocodilestick/calibre-web-automated:dev@sha256:fed9bc09df026a2b9aa965fca6105ec2ceefee770a2ce34c0f0322224086dbfd # TODO: pin to a specific tag when next release is made
    container_name: "{{ services.calibre_web_automated.container_name }}"
    restart: always
    networks:
      - default
      - caddy
    environment:
      - TZ={{ timezone }}
      - HARDCOVER_TOKEN={{ calibre_web_automated_hardcover_token }}
      - TRUSTED_PROXY_COUNT=2 # Cloudflare Tunnel + reverse proxy (Caddy)
    volumes:
      - "{{ calibre_web_automated_data_dir }}/config:/config"
      - "{{ calibre_web_automated_data_dir }}/upload:/cwa-book-ingest"
      - "{{ calibre_web_automated_data_dir }}/library:/calibre-library"
      - "{{ calibre_web_automated_data_dir }}/plugins:/config/.config/calibre/plugins"
    ports: !reset []

networks:
  caddy:
    external: true
