# external-file: https://raw.githubusercontent.com/nextcloud/all-in-one/refs/heads/main/compose.yaml
# digest: b4d0dcbf10a908082e531b6ad6264d47b1bb15de3b6a43b994e923b947c1a23d

services:
  nextcloud-aio-mastercontainer:
    image: nextcloud/all-in-one:latest@sha256:2e0d2eaa187e3139f1d7d7676cf1369a20ff7e4f70df3ecd516fdb0fd8d5dc5a
    restart: always
    container_name: "{{ services.nextcloud_aio.container_name }}"
    network_mode: !reset null
    networks:
      - caddy
    ports: !reset []
    environment:
      APACHE_PORT: {{ services.nextcloud.port }}
      APACHE_IP_BINDING: "127.0.0.1"
      APACHE_ADDITIONAL_NETWORK: "caddy"
      SKIP_DOMAIN_VALIDATION: false
      NEXTCLOUD_DATADIR: "{{ nextcloud_data_dir }}/data"

networks:
  caddy:
    external: true
