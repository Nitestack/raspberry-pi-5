services:
  server:
    image: gitea/gitea:1.24.7@sha256:918955f16b1e91732af6c449bb2db3a34271748dbed1ccfbae48f8a2fb5480b8
    container_name: "{{ services.gitea.container_name }}"
    environment:
      USER_UID: 1000
      USER_GID: 1000
      # Server
      GITEA__server__ROOT_URL: "https://{{ services.gitea.domain }}"
      GITEA__server__SSH_PORT: {{ gitea_ssh_port }}
      # Service
      GITEA__service__DISABLE_REGISTRATION: {{ gitea_disable_registration }}
      # Repository
      GITEA__repository__DISABLE_STARS: true
      GITEA__repository__ENABLE_PUSH_CREATE_USER: true
      GITEA__repository.pull-request__DEFAULT_MERGE_STYLE: "rebase-merge"
      # UI
      GITEA__ui__THEMES: "gitea-auto, gitea-light, gitea-dark, github-auto, github-light, github-dark, github-soft-dark"
      GITEA__ui__DEFAULT_THEME: "github-auto"
      # Mailer
      GITEA__mailer__ENABLED: true
      GITEA__mailer__FROM: "{{ no_reply_mail }}"
      GITEA__mailer__PROTOCOL: "smtp+starttls"
      GITEA__mailer__SMTP_ADDR: {{ smtp_host }}
      GITEA__mailer__SMTP_PORT: {{ smtp_port }}
      GITEA__mailer__USER: "{{ no_reply_mail }}"
      GITEA__mailer__PASSWD: "{{ smtp_password }}"
      # Other
      GITEA__other__SHOW_FOOTER_VERSION: false
      GITEA__other__SHOW_FOOTER_TEMPLATE_LOAD_TIME: false
    restart: always
    networks:
      - default
      - caddy
    volumes:
      - "{{ gitea_data_dir }}/data:/data"
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro
    ports:
      - "{{ gitea_ssh_port }}:22"

networks:
  caddy:
    external: true
