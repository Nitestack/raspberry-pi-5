---
- name: Configure Firewall with UFW
  become: true
  block:
    - name: Install UFW
      ansible.builtin.apt:
        name: ufw
        update_cache: true

    - name: Set default UFW policy and enable firewall
      community.general.ufw:
        state: enabled
        policy: "{{ ufw_incoming_policy }}"
        direction: incoming

    - name: Allow incoming traffic on specified ports
      community.general.ufw:
        rule: allow
        port: "{{ item }}"
      loop: "{{ allowed_ports }}"
      loop_control:
        label: "port {{ item }}"
